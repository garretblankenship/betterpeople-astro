<div>
    <p>Use Arrow Keys to move the player ( P ) to the exit ( E ).</p>

    <div id="game-container">
        <div id="maze">
            <!-- Maze cells will be generated by JavaScript -->
        </div>
        <div id="player">P</div>
    </div>

    <p>Time: <span id="timer">0.00</span> seconds</p>
    <p id="message"></p>
</div>

<style>
    body {
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    #game-container {
        position: relative; /* Needed for absolute positioning of the player */
        border: 2px solid #333;
        margin-top: 20px;
        /* Width and height will be set by JS based on maze size */
    }

    #maze {
        display: grid;
        /* grid-template-columns will be set by JS */
    }

    .cell {
        width: 30px;        /* Size of each cell */
        height: 30px;
        box-sizing: border-box; /* Include border in size */
    }

    .wall {
        background-color: #333; /* Dark color for walls */
    }

    .path {
        background-color: #fff; /* White for path */
        /* border: 1px solid #eee; /* Optional faint grid lines */
    }

    .start {
        background-color: lightgreen; /* Start color */
    }

    .end {
        background-color: lightcoral; /* End color */
        text-align: center;
        line-height: 30px; /* Vertically center 'E' */
        font-weight: bold;
    }

    #player {
        position: absolute;
        width: 26px;       /* Slightly smaller than cell */
        height: 26px;
        background-color: blue;
        color: white;
        border-radius: 50%; /* Make it a circle */
        text-align: center;
        line-height: 26px; /* Vertically center 'P' */
        font-weight: bold;
        margin: 2px;       /* Center it within the cell visually */
        transition: top 0.1s linear, left 0.1s linear; /* Smooth movement */
        z-index: 10;       /* Ensure player is above maze cells */
        box-sizing: border-box;
    }

    #message {
        margin-top: 15px;
        font-weight: bold;
        color: green;
        min-height: 1.2em; /* Prevent layout shift when message appears */
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const mazeContainer = document.getElementById('maze');
    const player = document.getElementById('player');
    const timerElement = document.getElementById('timer');
    const messageElement = document.getElementById('message');
    const gameContainer = document.getElementById('game-container'); // Get game container reference

    const CELL_SIZE = 30; // Must match CSS .cell width/height

    // Maze layout: '#' = Wall, ' ' = Path, 'S' = Start, 'E' = End
    const mazeLayout = [
        "S ###########",
        "            #",
        "### # ##### #",
        "#   #   #   #",
        "# ##### # # #",
        "# #     # # #",
        "# # ##### # #",
        "# #     #   #",
        "# ##### ### #",
        "#     # #   #",
        "##### # # ###",
        "#     #     E",
        "#############",
    ];

    const MAZE_WIDTH = mazeLayout[0].length;
    const MAZE_HEIGHT = mazeLayout.length;

    let playerPos = { x: 0, y: 0 };
    let startPos = { x: 0, y: 0 };
    let endPos = { x: 0, y: 0 };
    let startTime = null;
    let timerInterval = null;
    let gameWon = false;

    // --- Maze Creation ---
    function createMaze() {
        mazeContainer.innerHTML = ''; // Clear previous maze if any
        mazeContainer.style.gridTemplateColumns = `repeat(${MAZE_WIDTH}, ${CELL_SIZE}px)`;
        // Set container size based on maze dimensions and cell size
        gameContainer.style.width = `${MAZE_WIDTH * CELL_SIZE}px`;
        gameContainer.style.height = `${MAZE_HEIGHT * CELL_SIZE}px`;


        for (let y = 0; y < MAZE_HEIGHT; y++) {
            for (let x = 0; x < MAZE_WIDTH; x++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                const char = mazeLayout[y][x];

                if (char === '#') {
                    cell.classList.add('wall');
                } else if (char === ' ') {
                    cell.classList.add('path');
                } else if (char === 'S') {
                    cell.classList.add('start');
                    startPos = { x, y };
                    playerPos = { ...startPos }; // Set initial player position
                } else if (char === 'E') {
                    cell.classList.add('end');
                    cell.textContent = 'E'; // Add E text
                    endPos = { x, y };
                }
                mazeContainer.appendChild(cell);
            }
        }
    }

    // --- Player Positioning ---
    function placePlayer() {
        player.style.left = `${playerPos.x * CELL_SIZE}px`;
        player.style.top = `${playerPos.y * CELL_SIZE}px`;
    }

    // --- Collision Detection ---
    function isWall(x, y) {
        // Check bounds
        if (x < 0 || x >= MAZE_WIDTH || y < 0 || y >= MAZE_HEIGHT) {
            return true; // Out of bounds is like a wall
        }
        // Check maze layout
        return mazeLayout[y][x] === '#';
    }

    // --- Win Condition ---
    function checkWin(x, y) {
        return x === endPos.x && y === endPos.y;
    }

    // --- Timer ---
    function startTimer() {
        startTime = Date.now();
        messageElement.textContent = ''; // Clear any previous message
        gameWon = false;
        // Clear any existing interval before starting a new one
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(updateTimer, 50); // Update timer display frequently
    }

    function updateTimer() {
        if (gameWon || !startTime) return; // Stop if game won or not started

        const elapsedTime = (Date.now() - startTime) / 1000;
        timerElement.textContent = elapsedTime.toFixed(2);
    }

    function stopTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
    }

    // --- Game Logic ---
    function winGame() {
        gameWon = true;
        stopTimer();
        const finalTime = timerElement.textContent;
        messageElement.textContent = `You Win! Time: ${finalTime} seconds`;
        // Optionally: remove event listener to prevent further moves
        // document.removeEventListener('keydown', handleKeyPress);
    }

    // --- Movement Handling ---
    function handleKeyPress(event) {
        if (gameWon) return; // Don't move if game is over

        // Start timer on first move
        if (!startTime) {
            startTimer();
        }

        let newX = playerPos.x;
        let newY = playerPos.y;

        event.preventDefault();

        switch (event.key) {
            case 'ArrowUp':
                newY--;
                break;
            case 'ArrowDown':
                newY++;
                break;
            case 'ArrowLeft':
                newX--;
                break;
            case 'ArrowRight':
                newX++;
                break;
            default:
                return; // Ignore other keys
        }

        if (!isWall(newX, newY)) {
            playerPos.x = newX;
            playerPos.y = newY;
            placePlayer();

            if (checkWin(newX, newY)) {
                winGame();
            }
        }
    }

    // --- Initialization ---
    function initializeGame() {
        createMaze();
        placePlayer(); // Place player at start initially
        // Timer starts on first key press
        document.addEventListener('keydown', handleKeyPress);
    }

    initializeGame();
});
</script>